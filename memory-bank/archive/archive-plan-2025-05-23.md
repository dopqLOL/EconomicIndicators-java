# バックエンドポートフォリオAPI - 計画フェーズアーカイブ

**アーカイブ日**: 2025年5月23日 金曜日  
**プロジェクト**: 経済指標・ボラティリティ分析 REST API バックエンド  
**フェーズ**: 計画・設計

## 1. プロジェクト概要

本プロジェクトは、既存のMT5/MQL5/Python経済指標分析アプリケーションをSpring Boot/MySQL/REST APIに変換するものです。主な目的は、経済指標データとボラティリティデータを管理・分析するためのRESTfulバックエンドAPI構築です。

また、このプロジェクトはバックエンドエンジニアとしてのスキルを証明するポートフォリオとして機能し、以下の技術要素を網羅します：

- Spring Boot/Spring Data JPA
- RESTful API設計と実装
- データベース設計と最適化
- クリーンアーキテクチャの適用
- テスト駆動開発
- CI/CDパイプライン構築

## 2. 実装計画

### 2.1 スケジュール

| 日付 | 曜日 | 主要タスク | 予定進捗率 |
|------|------|------------|------------|
| 5/23 | 金   | プロジェクト計画・データベース設計・コーディング規約策定 | 10% |
| 5/24 | 土   | エンティティ層実装 | 20% |
| 5/25 | 日   | リポジトリ層実装 | 30% |
| 5/26 | 月   | サービス層基本実装 | 40% |
| 5/27 | 火   | サービス層応用実装 | 50% |
| 5/28 | 水   | コントローラー層実装I | 60% |
| 5/29 | 木   | コントローラー層実装II | 70% |
| 5/30 | 金   | CSVインポート機能実装 | 80% |
| 5/31 | 土   | 統計計算機能実装 | 90% |
| 6/1  | 日   | テストと最適化・ドキュメント整備 | 100% |

### 2.2 技術スタック

- **フレームワーク**: Spring Boot 3.3.12
- **言語**: Java 17
- **データアクセス**: Spring Data JPA
- **データベース**: MySQL / H2（テスト用）
- **ビルドツール**: Maven
- **テストフレームワーク**: JUnit, Mockito
- **APIドキュメント**: Swagger/OpenAPI
- **静的解析ツール**: SonarLint, Checkstyle
- **DB変更管理**: Flyway
- **CI/CD**: GitHub Actions

### 2.3 主要成功指標（KPI）

1. **機能面の指標**:
   - すべてのエンティティで基本CRUD操作が可能
   - CSVインポート機能が正常に動作
   - 統計計算機能が要件通り動作

2. **品質面の指標**:
   - サービス層のテストカバレッジ80%以上
   - APIレスポンス時間95%のリクエストで300ms以下
   - 静的解析ツールの警告ゼロ
   - 適切なエラーハンドリング

3. **学習面の指標**:
   - Spring Data JPAの基本概念理解
   - RESTful API設計原則の適用
   - データ処理アルゴリズムの実装
   - CI/CDパイプラインの構築

### 2.4 リスクと対策

| リスク | 影響度 | 対策 |
|--------|--------|------|
| 学習曲線の急さ | 中 | チュートリアルと参考資料を事前に準備、学習ノート作成 |
| 時間制約 | 高 | 優先順位付け、最小実装から始める、必要に応じてスコープ調整 |
| データ処理の複雑さ | 中 | 段階的実装、ユニットテスト重視、既存アルゴリズム参照 |
| 技術的問題 | 中 | Stack Overflow等のリソース活用、問題の早期特定と対応 |

## 3. コーディング規約

### 3.1 基本原則

- **シンプルさ**: 複雑な実装より単純な実装を優先する
- **読みやすさ**: コードは「書く時間より読む時間の方が長い」という原則を常に意識
- **SOLID原則**: 単一責任、オープン・クローズド、リスコフの置換、インターフェイス分離、依存性逆転
- **自己文書化コード**: コメントに頼らず、コード自体が意図を明確に表現する

### 3.2 命名規則

- **クラス名**: PascalCase形式で、名詞または名詞句（`EconomicIndicator`）
- **メソッド/変数名**: camelCase形式で、動詞または動詞句（`findByCountry`）
- **定数**: UPPER_SNAKE_CASE形式（`MAX_RETRY_COUNT`）
- **パッケージ名**: すべて小文字（`com.portfolio.service`）

### 3.3 コード構造

- **クラス長**: 最大500行
- **メソッド長**: 最大30行
- **パラメータ数**: 最大3つ（それ以上は専用クラスを検討）
- **ネスト階層**: 最大3階層
- **メンバー順序**: 静的フィールド → インスタンスフィールド → コンストラクタ → メソッド

### 3.4 Spring Boot特有の規約

- **コンストラクタ注入**: フィールド注入ではなくコンストラクタ注入を使用
- **レイヤー分離**: コントローラー、サービス、リポジトリの責務を明確に分ける
- **バリデーション**: コントローラーレベルでの入力検証と、サービスレベルでのビジネスルール検証
- **例外処理**: グローバル例外ハンドラーによる一貫した例外処理

## 4. アーキテクチャ設計

### 4.1 ヘキサゴナルアーキテクチャ概要

本プロジェクトでは、ヘキサゴナルアーキテクチャ（ポートとアダプターパターン）を採用することで、ビジネスロジックと技術的実装の分離を実現します。このアーキテクチャの主要なコンセプトは：

- **ポート**: アプリケーションとの相互作用点（インターフェース）
  - プライマリポート: アプリケーションを使用するためのインターフェース
  - セカンダリポート: アプリケーションが外部リソースを使用するためのインターフェース

- **アダプター**: ポートを実装し、外部システムとの連携を担当
  - プライマリアダプター: 外部からのリクエストを処理（RESTコントローラー）
  - セカンダリアダプター: 外部システムへのアクセスを実装（DBリポジトリ）

- **ドメインモデル**: ビジネスロジックとルールを含むコアオブジェクト

### 4.2 パッケージ構造

```
com.portfolio.backend_portfolio_api/
├── application/                  # アプリケーション層
│   ├── dto/                      # データ転送オブジェクト
│   ├── port/                     # ポート定義
│   │   ├── in/                   # プライマリポート
│   │   └── out/                  # セカンダリポート
│   └── service/                  # アプリケーションサービス
│
├── domain/                       # ドメイン層
│   ├── model/                    # ドメインモデル
│   ├── service/                  # ドメインサービス
│   └── exception/                # ドメイン例外
│
├── adapter/                      # アダプター層
│   ├── in/                       # プライマリアダプター
│   │   ├── web/                  # REST APIコントローラー
│   │   └── batch/                # バッチ処理
│   └── out/                      # セカンダリアダプター
│       ├── persistence/          # データベースアダプター
│       └── external/             # 外部サービスアダプター
│
└── infrastructure/               # インフラストラクチャ層
    ├── config/                   # 設定クラス
    ├── security/                 # セキュリティ設定
    ├── exception/                # 例外ハンドリング
    └── util/                     # ユーティリティクラス
```

### 4.3 レイヤー間の依存関係

```
interfaces ──────┐
                 ↓
application ─────┐
                 ↓
domain ←─────────┘
  ↑
infrastructure ──┘
```

ドメイン層は他のレイヤーに依存せず、アプリケーション層はドメイン層に、インターフェース層とインフラストラクチャ層はアプリケーション層とドメイン層に依存します。これにより、ドメインロジックが技術的な実装の詳細から保護されます。

### 4.4 主要エンティティ設計

1. **EconomicIndicator（経済指標）**:
   - 属性: ID, 日時, 国, 指標名, 実績値, 予測値, 前回値, 影響度
   - 関係: VolatilityDataとの1対多関係

2. **VolatilityData（ボラティリティデータ）**:
   - 属性: ID, 日時, 高値, 安値, ボラティリティ値, カテゴリ
   - 関係: EconomicIndicatorとの多対1関係

3. **User（ユーザー）**:
   - 属性: ID, ユーザー名, パスワード, メールアドレス, 作成日時, 更新日時
   - 関係: UserSettingとの1対1関係

4. **UserSetting（ユーザー設定）**:
   - 属性: ID, ユーザーID, 表示設定, 通知設定, 更新日時
   - 関係: Userとの1対1関係

### 4.5 API設計

#### RESTエンドポイント

| メソッド | エンドポイント | 説明 |
|---------|---------------|------|
| GET     | /api/v1/indicators | すべての経済指標を取得 |
| GET     | /api/v1/indicators/{id} | 指定IDの経済指標を取得 |
| POST    | /api/v1/indicators | 新しい経済指標を作成 |
| PUT     | /api/v1/indicators/{id} | 経済指標を更新 |
| DELETE  | /api/v1/indicators/{id} | 経済指標を削除 |
| GET     | /api/v1/volatilities/indicator/{id} | 指標に関連するボラティリティを取得 |
| POST    | /api/v1/import/csv | CSVデータをインポート |
| GET     | /api/v1/statistics/{indicator}/{timeframe} | 統計情報を計算 |

### 4.6 テスト戦略

テストピラミッドに基づき、以下の割合でテストを実装します：

- **単体テスト (80%)**: サービス、リポジトリ、ドメインモデルのテスト
- **統合テスト (15%)**: コントローラー、DB連携のテスト
- **E2Eテスト (5%)**: APIエンドポイントの機能テスト

テスト命名規則は `givenXXX_whenYYY_thenZZZ` 形式を使用し、各テストはArrange-Act-Assert（AAA）パターンに従います。

## 5. 今日の振り返り

### 5.1 達成したこと

- プロジェクトの全体計画と日次スケジュールの策定
- 技術スタックの選定と詳細化
- コーディング規約の作成
- ヘキサゴナルアーキテクチャ設計
- エンティティ・API設計

### 5.2 課題と改善点

- **時間管理**: 設計ドキュメント作成に予想以上に時間がかかった。今後はタイムボックス法を使用して各作業に時間制限を設ける。
- **CSV構造分析**: 旧システムのCSVデータの完全な分析が未完了。明日の実装前にサンプルデータを詳細に確認する。
- **テスト計画**: テストケースの具体的な設計が不足している。各機能実装前に具体的なテストケースを設計する。

### 5.3 次のステップ

- Spring Data JPAの依存関係追加
- データベース接続設定
- 最初のエンティティクラスとマイグレーションスクリプトの実装
- リポジトリインターフェースの作成

## 6. 参考リソース

- [Spring Boot公式ドキュメント](https://spring.io/projects/spring-boot)
- [Baeldung - Spring Data JPA](https://www.baeldung.com/the-persistence-layer-with-spring-data-jpa)
- [Martin Fowler - Hexagonal Architecture](https://www.martinfowler.com/articles/injection.html)
- [Microsoft - REST API Design Best Practices](https://docs.microsoft.com/en-us/azure/architecture/best-practices/api-design)

## 7. アーカイブ情報

- **作成者**: バックエンドエンジニア志望者
- **アーカイブ日時**: 2025年5月23日 23:51
- **関連ドキュメント**:
  - memory-bank/implementation-plan.md
  - memory-bank/code_standards.md
  - memory-bank/architecture-design.md
  - memory-bank/reflection/reflection-2025-05-23.md 