# Backend Portfolio API - 実装計画

## 📅 プロジェクト概要

- **開始日**: 2025年5月23日（金）
- **完了予定日**: 2025年6月1日（日）
- **プロジェクト目標**: 経済指標とボラティリティ分析のREST APIバックエンド実装

## 📋 全体スケジュール

| 日付 | 曜日 | 主要タスク | 予定進捗率 |
|------|------|------------|------------|
| 5/23 | 金   | プロジェクト計画・データベース設計・コーディング規約策定 | 10% |
| 5/24 | 土   | エンティティ層実装 | 20% |
| 5/25 | 日   | リポジトリ層実装 | 30% |
| 5/26 | 月   | サービス層基本実装 | 40% |
| 5/27 | 火   | サービス層応用実装 | 50% |
| 5/28 | 水   | コントローラー層実装I | 60% |
| 5/29 | 木   | コントローラー層実装II | 70% |
| 5/30 | 金   | CSVインポート機能実装 | 80% |
| 5/31 | 土   | 統計計算機能実装 | 90% |
| 6/1  | 日   | テストと最適化・ドキュメント整備 | 100% |

## 🛠️ 技術スタック

- **フレームワーク**: Spring Boot 3.3.12
- **言語**: Java 17
- **データアクセス**: Spring Data JPA
- **データベース**: MySQL / H2（テスト用）
- **ビルドツール**: Maven
- **テストフレームワーク**: JUnit, Mockito
- **APIドキュメント**: Swagger/OpenAPI
- **静的解析ツール**: SonarLint, Checkstyle
- **DB変更管理**: Flyway
- **CI/CD**: GitHub Actions

## 📚 実装フェーズ詳細

### 1. データベース設計と環境構築（Day 1: 5/23）

#### 主要タスク
- データベースモデル設計の最終確認
- エンティティ関係の明確化
- コーディング規約とアーキテクチャ設計の策定
- 開発環境構築計画の作成

#### 成果物
- データベーススキーマ設計ドキュメント
- エンティティ設計ドキュメント
- コーディング規約文書
- アーキテクチャ設計文書
- 実装詳細ドキュメント

### 2. エンティティ層実装（Day 2: 5/24）

#### 主要タスク
- JPA依存関係追加
- データベース接続設定
- 各エンティティクラス実装
- エンティティ間のリレーション設定
- Flywayマイグレーションスクリプト作成

#### 成果物
- 更新されたpom.xml（JPA依存関係含む）
- application.propertiesファイル
- エンティティJavaクラス
- マイグレーションスクリプト

### 3. リポジトリ層実装（Day 3: 5/25）

#### 主要タスク
- リポジトリインターフェース実装
- テスト用データ生成
- リポジトリの単体テスト実装
- カスタムクエリメソッド作成

#### 成果物
- リポジトリインターフェースJavaクラス
- テストデータSQLスクリプト
- リポジトリテストクラス

### 4. サービス層基本実装（Day 4: 5/26）

#### 主要タスク
- 経済指標サービス実装
- ボラティリティデータサービス実装
- 基本CRUD操作実装
- 例外処理クラス定義

#### 成果物
- サービスJavaクラス
- サービスインターフェース
- 例外処理クラス
- サービス層テスト

### 5. サービス層応用実装（Day 5: 5/27）

#### 主要タスク
- ユーザーサービス実装
- ユーザー設定サービス実装
- 統計計算サービス基本実装
- サーキットブレーカーパターン実装

#### 成果物
- 追加サービスJavaクラス
- 統計計算ユーティリティクラス
- サービステストクラス
- 耐障害性パターン実装

### 6. コントローラー層実装I（Day 6: 5/28）

#### 主要タスク
- 経済指標コントローラー実装
- API DTOクラス設計
- 基本的な例外処理実装
- グローバル例外ハンドラー作成
- APIバージョニング戦略の実装

#### 成果物
- コントローラーJavaクラス
- DTOクラス
- グローバル例外ハンドラー
- コントローラーテスト

### 7. コントローラー層実装II（Day 7: 5/29）

#### 主要タスク
- ボラティリティコントローラー実装
- 残りのエンドポイント実装
- API統合テスト実装
- OpenAPI（Swagger）設定

#### 成果物
- 追加コントローラーJavaクラス
- コントローラーテストクラス
- Postmanコレクション
- API文書自動生成

### 8. CSVインポート機能実装（Day 8: 5/30）

#### 主要タスク
- CSVファイル読み込み機構実装
- データマッピング機能実装
- インポートAPIエンドポイント実装
- CI/CDパイプライン設定

#### 成果物
- CSVユーティリティクラス
- インポートサービスクラス
- ファイルアップロードコントローラー
- GitHub Actions設定ファイル

### 9. 統計計算機能実装（Day 9: 5/31）

#### 主要タスク
- 3分類アルゴリズム実装
- 平均値・中央値計算機能実装
- 地合い判断ロジック実装
- パフォーマンステスト実施

#### 成果物
- 統計計算サービスクラス
- アルゴリズム実装クラス
- 統計計算テストクラス
- パフォーマンステスト結果

### 10. テストと最適化（Day 10: 6/1）

#### 主要タスク
- テストカバレッジ向上
- パフォーマンス最適化
- ドキュメント整備
- 採用担当者向けハイライト文書作成

#### 成果物
- テストレポート
- READMEの更新
- APIドキュメント
- 技術的ハイライト文書

## 📊 主要成功指標

1. **機能面の指標**:
   - すべてのエンティティで基本CRUD操作が可能
   - CSVインポート機能が正常に動作
   - 統計計算機能が要件通り動作

2. **品質面の指標**:
   - サービス層のテストカバレッジ80%以上
   - APIレスポンス時間95%のリクエストで300ms以下
   - 静的解析ツールの警告ゼロ
   - 適切なエラーハンドリング

3. **学習面の指標**:
   - Spring Data JPAの基本概念理解
   - RESTful API設計原則の適用
   - データ処理アルゴリズムの実装
   - CI/CDパイプラインの構築

## 🧪 テスト戦略

### テストピラミッド
1. **単体テスト (80%)**:
   - 各サービスクラスのテスト
   - リポジトリ層のテスト
   - ユーティリティクラスのテスト
   - モックを活用したサービスの分離テスト

2. **統合テスト (15%)**:
   - コントローラー層のテスト
   - エンドツーエンドAPI呼び出しテスト
   - データベーストランザクションのテスト
   - 実DBを使用したリポジトリテスト

3. **E2Eテスト (5%)**:
   - RestAssuredを使用したAPI全体テスト
   - 主要ユースケースのシナリオテスト

### テスト命名規約
```java
// given_when_then形式
void givenValidEconomicIndicator_whenSave_thenSuccess()
void givenInvalidData_whenProcessCsv_thenThrowException()
```

## 📝 コーディング規約

### Javaコーディング規約
- **命名規則**:
  - クラス名: `PascalCase` (例: `EconomicIndicator`)
  - メソッド/変数名: `camelCase` (例: `findByCountry`)
  - 定数: `UPPER_SNAKE_CASE` (例: `MAX_RETRY_COUNT`)
  - パッケージ名: すべて小文字 (例: `com.portfolio.repository`)

- **コメント規約**:
  - クラス/インターフェース: Javadocスタイルで目的と責任を記述
  - パブリックメソッド: パラメータ、戻り値、例外の説明を含める
  - 複雑なロジック: 処理内容を説明するインラインコメント

- **コード構造**:
  - メソッド長: 30行以内を目標
  - クラス長: 500行以内を目標
  - パラメータ数: 最大3つ、それ以上は専用クラス使用

### Spring Bootベストプラクティス
- **レイヤー分離**:
  - コントローラー: リクエスト処理と応答生成のみ
  - サービス: ビジネスロジック集約
  - リポジトリ: データアクセスのみ
  - 明確な責任境界の維持

- **依存性注入**:
  - コンストラクタ注入を優先 (`@Autowired`はフィールドに直接使わない)
  - コンポーネントはインターフェースで依存関係を定義

## 🚧 リスクと対策

| リスク | 影響度 | 対策 |
|--------|--------|------|
| 学習曲線の急さ | 中 | チュートリアルと参考資料を事前に準備、学習ノート作成 |
| 時間制約 | 高 | 優先順位付け、最小実装から始める、必要に応じてスコープ調整 |
| データ処理の複雑さ | 中 | 段階的実装、ユニットテスト重視、既存アルゴリズム参照 |
| 技術的問題 | 中 | Stack Overflow等のリソース活用、問題の早期特定と対応 |

## 🏗 アーキテクチャ設計

### ヘキサゴナルアーキテクチャ
```
com.portfolio.backend_portfolio_api
├── application/        # ユースケース実装
│   └── service/
├── domain/             # ビジネスモデルとルール
│   ├── model/
│   └── service/
├── infrastructure/     # 技術的実装詳細
│   ├── persistence/
│   └── api/
└── interfaces/         # 外部とのインターフェース
    ├── rest/
    └── scheduler/
```

### APIデザイン規約
- **URI命名**:
  - リソース名は複数形名詞 (例: `/api/indicators`, `/api/volatilities`)
  - クエリパラメータは検索/フィルタリング用 (例: `/api/indicators?country=US`)

- **HTTPメソッド**:
  - GET: リソース取得(安全かつべき等)
  - POST: リソース作成
  - PUT: リソース全体更新
  - PATCH: リソース部分更新
  - DELETE: リソース削除

- **レスポンス形式**:
  ```json
  {
    "status": "success",
    "data": { ... },
    "message": "操作が正常に完了しました"
  }
  ```

### APIバージョニング戦略
- URLベースバージョニング: `/api/v1/indicators`
- ヘッダーベースバージョニング: `Accept: application/vnd.portfolio.v1+json`
- バージョン間の機能マッピングサービス

## 🔄 データベースマイグレーション戦略

### Flyway設定
- **マイグレーションスクリプト命名規則**:
  ```
  V1.0.0__create_initial_schema.sql
  V1.0.1__add_economic_indicators.sql
  V1.1.0__add_volatility_data.sql
  ```

- **バージョン管理方針**:
  - マイナーバージョン: スキーマ変更なし
  - メジャーバージョン: スキーマ変更あり

## 🔄 CI/CD設定

### GitHub Actions
```yaml
name: Java CI with Maven

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
    - name: Build with Maven
      run: mvn -B package --file pom.xml
    - name: Run tests
      run: mvn test
    - name: Code quality analysis
      run: mvn sonar:sonar
```

### 環境別デプロイメント
- 開発環境: プッシュ時に自動デプロイ
- テスト環境: 開発環境での自動テスト通過後にデプロイ
- 本番環境: 手動承認後にデプロイ

## 📝 採用強化のためのドキュメント計画

1. **コード内ドキュメント**:
   - Javadocスタイルのコメント
   - 複雑なロジックへの詳細説明
   - パブリックAPIの使用方法説明

2. **外部ドキュメント**:
   - README.md（プロジェクト概要、セットアップ手順）
   - API使用ガイド
   - データモデル説明
   - システム設計文書(アーキテクチャ図含む)

3. **学習記録**:
   - 学習ノート（概念、ベストプラクティス）
   - 日次振り返り
   - 開発進捗記録

4. **採用担当者向けハイライト**:
   - 最も複雑な技術課題と解決策
   - パフォーマンス最適化事例
   - コード品質維持のためのアプローチ
   - スケーラビリティを考慮した設計ポイント

## 📈 拡張性計画

1. **短期的拡張**:
   - API機能の段階的強化
   - テストカバレッジの向上
   - パフォーマンス最適化

2. **長期的拡張**:
   - クライアント側実装との連携
   - 高度な統計分析機能追加
   - リアルタイムデータ更新機能

## 🎓 学習目標

1. **技術スキル**:
   - Spring Boot/Spring Data JPAの実践的理解
   - RESTful API設計のベストプラクティス
   - 効率的なデータベース操作

2. **開発プロセス**:
   - テスト駆動開発の部分的適用
   - ドキュメント中心の開発手法
   - 段階的実装と振り返りの習慣化

3. **問題解決能力**:
   - エラー診断と解決
   - パフォーマンス最適化
   - リファクタリング手法 