**再修正版 Webアプリケーション要件定義書 (さらにシンプルに)**

### 1. 概要

本プロジェクトは、外国為替市場における経済指標発表と、その後の価格変動（ボラティリティ）の関係を**参考情報として視覚的に表示する**Webアプリケーションを開発することを目的とする。過去5年分のMT5 ZigZagデータと、MQL5スクリプトを介して取得する当日の経済指標データを統合・分析し、ユーザーが当日の各指標が過去にどの程度の値動きに関連していたかを把握できるように支援する。

### 2. 背景・目的

* 当日に発表される経済指標が、過去のデータに基づいて、**どの程度の価格変動の可能性を秘めているかを参考程度に把握したい。**
* 経済指標のボラティリティ特性を**シンプルに**確認できるツールを提供する。

### 3. 主要機能要件

#### 3.1. データ処理・分析機能

1.  **データ取得・統合:**
    * **当日経済指標の取得:** ユーザー指示によりMQL5スクリプトを実行し、当日発表の経済指標情報（発表日時、国、指標名、重要度など）を取得する。
    * **MT5 ZigZagデータの読み込み:** 過去5年分の指定されたZigZagデータCSVファイルを読み込み、統合する。時刻情報はJSTに変換する。
    * **データ紐付けと基本ボラティリティ計算:** 当日の各経済指標について、その発表日時に対応する**指定された特定の時間帯（例: 日本時間の午前7時から午前9時まで）**のZigZagデータから高値と安値を特定し、その差（以下「時間帯ボラティリティ」と呼ぶ）を算出する。

2.  **統計分析 (各当日指標ごと、過去5年分の「時間帯ボラティリティ」を使用):**
    * **3分類別平均値の算出:**
        * 各経済指標の過去の「時間帯ボラティリティ」を大きさによって「大」「中」「小」の3つのカテゴリに分類する（分類ロジック: パーセンタイル値 大:上位33%, 中:中間33%, 小:下位33%）。
        * 各分類の平均「時間帯ボラティリティ」を算出する。
        * データ僅少時の扱い（例: 「N/A」表示）を考慮する。
    * **中央値の算出:** 各経済指標の過去の「時間帯ボラティリティ」の中央値を算出する。

3.  **地合い判断機能:**
    * 各当日指標について、その指標の**直近2回（または直近2日）の発表時の「時間帯ボラティリティ」**と、その指標の**過去5年間の「時間帯ボラティリティ」の平均値**とを比較する。
    * その差に基づいて、短期的な地合いを「大」「中」「小」の3段階で参考表示する（具体的な分類閾値は別途定義）。

4.  **直近実績値の抽出:**
    * 各当日指標について、その指標の直近2回の発表時の「時間帯ボラティリティ」の数値を抽出する。

#### 3.2. Webアプリケーション表示機能

1.  **当日指標一覧・分析結果表示:**
    * 当日MQL5スクリプトで取得した経済指標の一覧をメインに表示する。
    * 各指標について、以下の情報をテーブル形式で表示する。
        * 発表時刻 (JST)
        * 国
        * 指標名
        * 重要度
        * 過去の「時間帯ボラティリティ」大分類平均値
        * 過去の「時間帯ボラティリティ」中分類平均値
        * 過去の「時間帯ボラティリティ」小分類平均値
        * 過去の「時間帯ボラティリティ」中央値
        * 直近2回の過去の「時間帯ボラティリティ」の数値
        * 地合い判断の結果（大・中・小）
    * ソート機能（例: 発表時刻順）を設ける。

### 4. 非機能要件 (最小限)

* **使用技術スタック:** Streamlit, Pandas。
* **実行環境:** ローカルPC。

### 5. データソース

1.  **当日経済指標データ:** MQL5スクリプトから取得。
2.  **MT5 ZigZagデータ:** 過去5年分のCSVファイル。

---

**この「さらにシンプルな」要件定義書のポイント：**

* **あなたの4つの核となる機能に完全に絞り込みました。**
* 「背景・目的」も、よりシンプルに「参考程度に把握したい」という点にフォーカスしました。
* 「統計分析」セクションでは、あなたがリストアップした項目（3分類平均値、中央値）のみに限定しました。
* 「Webアプリケーション表示機能」も、表示項目をあなたの4つのポイントから導き出される情報に限定しました。
* 非機能要件やデータソースも、最小限の記述に留めています。
* AIが提案していた「その他の変動分析」「指標詳細表示」「設定・フィルタ機能」「VPS運用」といった高度な機能や詳細な検討事項は、**完全に削除**しました。これらは、まずこのシンプルなコア機能が完成した後に、必要に応じて追加していく機能として考えます。

**この修正版の要件定義書をAI（PLANモード）に提示する際の指示例：**

「PLANモードを開始します。
以前の要件定義は少し複雑すぎたので、もっとシンプルな形に修正しました。以下の要件定義に基づいて、Webアプリケーションの開発計画を立ててください。

（ここに上記の「再修正版 Webアプリケーション要件定義書」を貼り付ける）

この要件定義に記載されている機能のみを対象とし、これ以外の機能（例えば、詳細なチャート表示、ユーザーによるフィルタ設定、VPS運用など）は、現時点では計画に含めないでください。
まずは、このシンプルなコア機能を確実に実現するための、最小限のステップとコンポーネントで計画を作成してください。」

---
